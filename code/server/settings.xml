<?xml version="1.0" encoding="UTF-8"?>

<!-- -->
<settings>
	<database name="stats">
		<tables>
			<table>events</table> 
			<events>
				<primary-key><![CDATA[id]]></primary-key>
				<column>
					<name>id</name>
					<dbtype>integer</dbtype>
				</column>
				<column>
					<name>name</name>
					<dbtype>text</dbtype>
				</column>
				<column>
					<name>date</name>
					<dbtype>text</dbtype>
				</column>
				<column>
					<name>organization</name>
					<dbtype>text</dbtype>
				</column>
				<column>
					<name>location</name>
					<dbtype>text</dbtype>
				</column>
				<column>
					<name>attendance</name>
					<dbtype>integer</dbtype>
				</column>
				<column>
					<name>completed</name>
					<dbtype>integer</dbtype>
				</column>
				<column>
					<name>child_url</name>
					<dbtype>text</dbtype>
				</column>
				<column>
					<name>child_updated</name>
					<dbtype>integer</dbtype>
				</column>		
			</events>

			<table>tmp_events</table>
			<tmp_events>
				<primary-key><![CDATA[id]]></primary-key>
				<column>
					<name>id</name>
					<dbtype>integer</dbtype>
				</column>
				<column>
					<name>completed</name>
					<dbtype>integer</dbtype>
				</column>
				<column>
					<name>child_url</name>
					<dbtype>text</dbtype>
				</column>
			</tmp_events>
		</tables>
	</database>

	<!-- scraper tasks settings -->
	<scrapers>
		<completed-events>
			<prepared-statement>
				<name>clear</name>
				<statement><![CDATA[DELETE FROM tmp_events]]></statement>
			</prepared-statement>
			<prepared-statement>
				<name>insert</name>
				<statement><![CDATA[INSERT OR REPLACE INTO tmp_events (id, completed, child_url) VALUES (?, 1, ?)]]></statement>
			</prepared-statement>

			<table-regex><![CDATA[(<div[\s]class="events_table[\s]data_table[\s]row_is_link">)([\w\W]*?)(</div>)]]></table-regex>
			<index-delimiter><![CDATA[</tr>[\w\W]*?<tr.+?>]]></index-delimiter>
			<source-url><![CDATA[http://hosteddb.fightmetric.com/events/index/date/desc/1/all]]></source-url>

			<scrape-field>
				<name>id</name>
				<apptype>integer</apptype>
				<regex><![CDATA[(.events.details.)(\d+)(\D)]]></regex>
			</scrape-field>
			<scrape-field>
				<name>child_url</name> 
				<apptype>string</apptype>
				<regex><![CDATA[(<td[\s]class="left_border"><a href=")(.*)(">)]]></regex>
			</scrape-field>
		</completed-events>

		<upcoming-events>
			<prepared-statement>
				<name>clear</name>
				<statement><![CDATA[DELETE FROM tmp_events]]></statement>
			</prepared-statement>
			<prepared-statement>
				<name>insert</name>
				<statement><![CDATA[INSERT OR REPLACE INTO tmp_events (id, completed, child_url) VALUES (?, 0, ?)]]></statement>
			</prepared-statement>
			
			<table-regex><![CDATA[(<div[\s]class="events_table[\s]data_table[\s]row_is_link">)([\w\W]*?)(</div>)]]></table-regex>
			<index-delimiter><![CDATA[</tr>[\w\W]*?<tr.+?>]]></index-delimiter>
			<source-url><![CDATA[http://hosteddb.fightmetric.com/events/index/date/asc/0/all/]]></source-url>

			<scrape-field>
				<name>id</name>
				<apptype>integer</apptype>
				<regex><![CDATA[(.events.details.)(\d+)(\D)]]></regex>
			</scrape-field>
			<scrape-field>
				<name>child_url</name> 
				<apptype>string</apptype>
				<regex><![CDATA[(<td[\s]class="left_border"><a href=")(.*)(">)]]></regex>
			</scrape-field>
		</upcoming-events>
	</scrapers>
</settings> 